<!DOCTYPE html>
<html>
  <head>
    <title>WeighEasy-Mobile-App</title>    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script data-require="jquery@*" data-semver="2.1.1" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.4.5/jquery.mobile.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.4.5/jquery.mobile.min.css" /> -->
    <!-- FHIR Client JS Library -->
    <script src='./lib/js/jqFhir.js'></script>
  </head>
  <body>
        <div id="employeeListPage" data-role="page" >
            <div data-role="header" data-position="fixed">
                <h1>Patient Demographics</span></h1>
            </div>
        </div>
        <div data-role="main" class="ui-content">
            <table>
                <tr>
                <th>Name:</th>
                <td id='name'></td>
                </tr>
                <tr>
                <th>Gender:</th>
                <td id='gender'></td>
                </tr>
                <tr>
                <th>Weight:</th>
                <td id='curweight'></td>
                </tr>
            </table>
        </div>
    <script type="text/javascript">  
        function displayPatient(pt){
            var fullname = '';
            pt.name.forEach(function(ptName){
                if(typeof ptName !== 'undefined'){
                    if(ptName.use == 'official'){
                        fullname = ptName.given.join(" ") + " " + ptName.family.join(" ");
                    }
                }
            });
            if(fullname != ''){                    
               $('#name').html = fullname;
            }
            else {
                $('#name').html = "anonymous";
            } 
            $('#gender').htmml = pt.gender;
        }

        function getObservationResult(ob){
            if (typeof ob != 'undefined' &&
                typeof ob.valueQuantity != 'undefined' &&
                typeof ob.valueQuantity.value != 'undefined' &&
                typeof ob.valueQuantity.unit != 'undefined') {
                return ob.valueQuantity.value + ' ' + ob.valueQuantity.unit;
            } 
            else {
                return undefined;
            }
        }

        FHIR.oauth2.ready(function(smart){
            smart.patient.read().then(function(pt) {
                displayPatient (pt);
            });
            smart.patient.api.fetchAll({type: 'Observation'}).then(function(obv){
                var byCodes = smart.byCodes(obv, 'code');
                var bodyWeight = byCodes('29463-7');
                $('#curweight').html = getObservationResult(bodyWeight[0]);
            });
        });
    </script>
  </body>
</html>